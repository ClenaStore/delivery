<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>Monte Seu Prato - Del√≠cia Gourmet</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

<style>
:root{
  --white:#ffffff;
  --black:#0b0f19;
  --orange:#ff7b00;
  --red:#e53935;
  --gray:#f6f6f6;
  --text:#1e293b;
  --radius:14px;
}
*{box-sizing:border-box;margin:0;padding:0;font-family:'Inter',sans-serif}
body{background:var(--gray);color:var(--text);min-height:100vh;}
header{text-align:center;padding:20px;background:var(--black);color:var(--white);}
header h1{font-size:1.6rem;font-weight:600;letter-spacing:1px;}
main{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;padding:20px;max-width:1000px;margin:auto;}
.card{background:var(--white);border-radius:var(--radius);overflow:hidden;box-shadow:0 5px 15px rgba(0,0,0,0.08);cursor:pointer;transition:.2s;}
.card:hover{transform:translateY(-3px);}
.card img{width:100%;height:160px;object-fit:cover;}
.card-content{padding:15px;}
.card-content h2{font-size:1.1rem;margin-bottom:4px;}
.card-content p{color:#64748b;font-size:.9rem;margin-bottom:8px;}
.price{font-weight:600;color:var(--orange);font-size:1rem;}

/* MODAL */
.modal-bg{
  position:fixed;top:0;left:0;width:100%;height:100%;
  background:rgba(0,0,0,0.65);display:none;align-items:center;justify-content:center;z-index:10;
}
.modal{
  background:var(--white);
  border-radius:10px;
  width:95%;max-width:520px;
  height:85vh;overflow-y:auto;
  margin-top:20px;
  position:relative;
  animation:fadeIn .25s ease;
}
.modal img{width:100%;height:200px;object-fit:cover;}
.modal-content{padding:20px;padding-top:60px;}
.modal h2{font-size:1.2rem;margin:10px 0;color:var(--black);}
.modal .price{color:var(--orange);font-size:1.1rem;margin-bottom:5px;}
.modal small{color:var(--red);font-size:.8rem;}
section{margin:20px 0;}
section h3{color:var(--black);font-size:1rem;margin-bottom:6px;}
section p.sub{font-size:.85rem;color:#64748b;margin-bottom:8px;}
.option{display:flex;align-items:center;gap:8px;margin:6px 0;}
.option input[type="checkbox"]{
  accent-color:var(--orange);
  cursor:pointer;width:18px;height:18px;border-radius:50%;
  appearance:none;border:2px solid #ccc;position:relative;outline:none;
}
.option input[type="checkbox"]:checked{border-color:var(--orange);}
.option input[type="checkbox"]::before{
  content:"";position:absolute;top:3px;left:3px;width:10px;height:10px;border-radius:50%;
  background:var(--orange);opacity:0;transition:.2s;
}
.option input[type="checkbox"]:checked::before{opacity:1;}
.option label{cursor:pointer;}
.limit-info{text-align:right;font-size:.8rem;color:var(--red);}
#faltam{text-align:center;color:var(--red);margin-top:8px;font-size:.9rem;font-weight:600;}
.qty-area{display:flex;justify-content:center;align-items:center;gap:15px;margin:20px 0;}
.qty-area button{width:32px;height:32px;border:none;border-radius:6px;background:var(--orange);color:var(--white);font-size:1rem;cursor:pointer;}
#quant{font-weight:600;font-size:1.1rem;}
.btn-add{width:100%;padding:12px;background:#ddd;color:#999;border:none;border-radius:var(--radius);font-weight:600;text-transform:uppercase;cursor:not-allowed;}
.btn-active{background:var(--orange);color:var(--white);cursor:pointer;}

/* BOT√ÉO FIXO */
.close{
  position:fixed;
  top:12px;right:20px;
  background:var(--red);
  border:none;
  border-radius:50%;
  width:34px;height:34px;
  color:var(--white);
  font-size:1.3rem;
  cursor:pointer;
  box-shadow:0 2px 6px rgba(0,0,0,0.3);
  z-index:30;
}

@keyframes fadeIn{from{opacity:0;transform:scale(.95);}to{opacity:1;transform:scale(1);}}

/* Responsivo */
@media(max-width:600px){
 main{grid-template-columns:repeat(2,1fr);gap:12px;}
 .card img{height:120px;}
}
</style>
</head>
<body>

<header><h1>Delivery Del√≠cia Gourmet</h1></header>

<main>
  <div class="card" id="card-prato">
    <img src="https://github.com/ClenaStore/delivery/blob/main/paste/Captura%20de%20tela%202025-11-05%20101949.png?raw=true">
    <div class="card-content">
      <h2>Monte Seu Prato</h2>
      <p>Monte sua refei√ß√£o com ingredientes selecionados.</p>
      <div class="price">R$ 45,00</div>
    </div>
  </div>
</main>

<div class="modal-bg" id="modal-bg">
  <div class="modal" id="modal">
    <button class="close" id="close">&times;</button>
    <img src="https://github.com/ClenaStore/delivery/blob/main/paste/Captura%20de%20tela%202025-11-05%20101949.png?raw=true">
    <div class="modal-content">
      <h2>Monte Seu Prato</h2>
      <p class="price" id="precoBase">R$ 45,00</p>
      <small>üçΩÔ∏è Del√≠cia Gourmet - Almo√ßo</small>
      <hr style="border:0;border-top:1px solid #eee;margin:12px 0;">
      <div id="blocos"></div>
      <div id="faltam">Carregando...</div>
      <div class="qty-area">
        <button id="menos">‚àí</button>
        <span id="quant">1</span>
        <button id="mais">+</button>
      </div>
      <button id="btnAdd" class="btn-add">ADICIONAR AO PEDIDO R$ 45,00</button>
    </div>
  </div>
</div>

<script>
const URL_API = "https://script.google.com/macros/s/AKfycbyqTo0EHs_BgkAW7K8BuKX8DpmJD8LDrc89caNgjQmzCoydw1BeE1Ju52dWsAQ46P60Sg/exec";
const CACHE_KEY = "monte_prato_cache_v3";
const CACHE_TIME = 3 * 60 * 60 * 1000; // 3 horas

let cachedData = null;
let totalObrigatorias = 0;
let precoBase = 45.00;
let totalAdicionais = 0;

// ===== PR√â-CARREGA OS ITENS =====
document.addEventListener("DOMContentLoaded", async ()=>{
  const cache = localStorage.getItem(CACHE_KEY);
  if(cache){
    const {data,time} = JSON.parse(cache);
    if(Date.now()-time < CACHE_TIME){
      cachedData = data;
      console.log("‚úÖ Itens carregados do cache");
      return;
    }
  }
  console.log("üîÑ Consultando dados do GAS...");
  const r = await fetch(`${URL_API}?acao=listarItens`);
  const data = await r.json();
  cachedData = data;
  localStorage.setItem(CACHE_KEY, JSON.stringify({data,time:Date.now()}));
});

// ===== REFER√äNCIAS =====
const modalBg=document.getElementById('modal-bg');
const blocos=document.getElementById('blocos');
const faltamEl=document.getElementById('faltam');
const btnAdd=document.getElementById('btnAdd');
const precoBaseEl=document.getElementById('precoBase');
let q=1;
const qEl=document.getElementById('quant');

// ===== CONTROLES =====
document.getElementById('card-prato').onclick=()=>abrirModal();
document.getElementById('close').onclick=()=>modalBg.style.display='none';
modalBg.onclick=e=>{if(e.target===modalBg)modalBg.style.display='none';};
document.getElementById('mais').onclick=()=>{q++;qEl.textContent=q;atualizarPreco()};
document.getElementById('menos').onclick=()=>{if(q>1){q--;qEl.textContent=q;atualizarPreco()}};

// ===== MONTA OS BLOCOS =====
function abrirModal(){
  modalBg.style.display='flex';
  blocos.innerHTML='<p style="text-align:center;color:#888;">Carregando op√ß√µes...</p>';
  if(!cachedData){faltamEl.textContent='Erro ao carregar dados.';return;}
  montarBlocos(cachedData);
}

function montarBlocos(data){
  blocos.innerHTML='';
  totalObrigatorias = Object.keys(data.categorias).length;

  Object.entries(data.categorias).forEach(([categoria,info],i)=>{
    const sec=document.createElement('section');
    sec.dataset.ok='0';
    sec.innerHTML=`<h3>${categoria}</h3>
    <p class="sub">M√≠nimo: ${info.minimo} - Selecionados: <span id="sel_${i}">0</span> / ${info.maximo}</p>`;
    info.itens.forEach((item,j)=>{
      const id=`${categoria}_${j}`;
      const input=document.createElement('input');
      input.type="checkbox";
      input.name=categoria;
      input.id=id;
      input.dataset.adicional=item.adicional||0;
      input.onclick=()=>gerenciarSelecao(input,sec,info,i);
      const label=document.createElement('label');
      label.className='option';
      label.appendChild(input);
      label.append(' '+item.nome+(item.adicional>0?` (+R$ ${item.adicional.toFixed(2).replace('.',',')})`:''));
      sec.appendChild(label);
    });
    const lim=document.createElement('div');
    lim.className='limit-info';
    lim.textContent=`Limite: ${info.maximo}`;
    sec.appendChild(lim);
    blocos.appendChild(sec);
  });
  atualizarStatus();
}

function gerenciarSelecao(input,sec,info,i){
  const selecionados=[...sec.querySelectorAll('input:checked')];
  const qt=selecionados.length;
  document.getElementById(`sel_${i}`).textContent=qt;

  if(qt>=info.maximo){
    sec.querySelectorAll('input:not(:checked)').forEach(el=>el.disabled=true);
    const prox=sec.nextElementSibling;
    if(prox)prox.scrollIntoView({behavior:'smooth'});
  } else {
    sec.querySelectorAll('input').forEach(el=>el.disabled=false);
  }

  sec.dataset.ok = qt >= info.minimo ? '1' : '0';
  atualizarStatus();
  atualizarPreco();
}

function atualizarPreco(){
  totalAdicionais = [...blocos.querySelectorAll('input:checked')]
    .reduce((soma,el)=>soma+Number(el.dataset.adicional||0),0);
  const total = (precoBase + totalAdicionais) * q;
  btnAdd.textContent=`ADICIONAR AO PEDIDO R$ ${total.toFixed(2).replace('.',',')}`;
}

function atualizarStatus(){
  const ok = [...blocos.querySelectorAll('section')].filter(s=>s.dataset.ok==='1').length;
  const faltam = totalObrigatorias - ok;
  if(faltam<=0){
    faltamEl.style.display='none';
    btnAdd.classList.add('btn-active');
    btnAdd.disabled=false;
  }else{
    faltamEl.textContent=`Ainda faltam ${faltam} se√ß√µes obrigat√≥rias`;
    faltamEl.style.display='block';
    btnAdd.classList.remove('btn-active');
    btnAdd.disabled=true;
  }
}
</script>

</body>
</html>
